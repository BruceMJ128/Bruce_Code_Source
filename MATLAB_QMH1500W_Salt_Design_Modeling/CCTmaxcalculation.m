% calculate the max CCT with the MR and salt weight
% z = 4142.55-64.352 .* x+0.372811 .* x.^2+306.51.*y-37.5465.*y.^2+1.54074.*y.^3+5.84999 .*x .*y-0.341499 .*x .*y.^2;
% x - slat weight, y - MR;
% dz/dy=306.51-37.5465*2.*y+1.54074*3.*y.^2+5.84999 .*x-0.341499 .*x *2.*y=0
j=1;
for x=30:0.1:60;
    a=1.54074*3;
    b=-37.5465*2-0.341499 .*x *2;
    c=306.51+5.84999 .*x;
    y = [a b c];
    r = roots(y);
        
    n=length(r);
    z=[];
    for k=1:n
        if isreal(r(k))==1
            if r(k)>5 && r(k)<13.25;
                r1=r(k)+0.1;
                r2=r(k)-0.1;
                CCT0=4142.55-64.352 .* x+0.372811 .* x.^2+306.51.*r(k)-37.5465.*r(k).^2+1.54074.*r(k).^3+5.84999 .*x .*r(k)-0.341499 .*x .*r(k).^2;
                CCT1=4142.55-64.352 .* x+0.372811 .* x.^2+306.51.*r1-37.5465.*r1.^2+1.54074.*r1.^3+5.84999 .*x .*r1-0.341499 .*x .*r1.^2;
                CCT2=4142.55-64.352 .* x+0.372811 .* x.^2+306.51.*r2-37.5465.*r2.^2+1.54074.*r2.^3+5.84999 .*x .*r2-0.341499 .*x .*r2.^2;
                if CCT0>CCT1 && CCT0>CCT2;
                    z(k)=r(k);
                end
            end            
        end
    end
    z(z==0)=[];
    m=length(z);
    if m~=0
        for kk=1:m
            MR(j,1)=x;
            MR(j,2)=z(kk);
            CCTMAX=4142.55-64.352 .* x+0.372811 .* x.^2+306.51.*z(kk)-37.5465.*z(kk).^2+1.54074.*z(kk).^3+5.84999 .*x .*z(kk)-0.341499 .*x .*z(kk).^2;
            MR(j,3)=CCTMAX;
            j=j+1;
        end
        j=j-1+m;
    end
end

